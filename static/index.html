<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AssistantMD</title>
    <base href="./">
    <link rel="stylesheet" href="static/output.css">
    <script src="static/vendor/marked.min.js"></script>
    <script src="static/vendor/dompurify.min.js"></script>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                processEscapes: true,
                packages: { '[+]': ['noerrors', 'noundefined'] }
            },
            options: {
                skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
            },
            loader: {
                load: ['[tex]/noerrors', '[tex]/noundefined']
            }
        };
    </script>
    <script src="static/vendor/mathjax/tex-chtml.js"></script>
    <style>
        /* Theme Color Variables */
        :root, [data-theme="light"] {
            --bg-app: 249 250 251;
            --bg-card: 255 255 255;
            --bg-elevated: 243 244 246;
            --text-primary: 17 24 39;
            --text-secondary: 107 114 128;
            --text-tertiary: 156 163 175;
            --accent-primary: 59 130 246;
            --accent-hover: 37 99 235;
            --border-primary: 229 231 235;
            --border-secondary: 209 213 219;
            --state-success: 34 197 94;
            --state-warning: 234 179 8;
            --state-info: 59 130 246;
            --state-error: 220 38 38;
            --text-on-accent: 255 255 255;
        }

        [data-theme="dark"] {
            --bg-app: 15 23 42;
            --bg-card: 30 41 59;
            --bg-elevated: 51 65 85;
            --text-primary: 241 245 249;
            --text-secondary: 203 213 225;
            --text-tertiary: 148 163 184;
            --accent-primary: 96 165 250;
            --accent-hover: 59 130 246;
            --border-primary: 51 65 85;
            --border-secondary: 71 85 105;
            --state-success: 74 222 128;
            --state-warning: 251 191 36;
            --state-info: 125 211 252;
            --state-error: 239 68 68;
            --text-on-accent: 255 255 255;
        }

        [data-theme="ocean"] {
            --bg-app: 240 249 255;
            --bg-card: 224 242 254;
            --bg-elevated: 186 230 253;
            --text-primary: 12 74 110;
            --text-secondary: 14 116 144;
            --text-tertiary: 22 78 99;
            --accent-primary: 6 182 212;
            --accent-hover: 8 145 178;
            --border-primary: 186 230 253;
            --border-secondary: 125 211 252;
            --state-success: 16 185 129;
            --state-warning: 245 158 11;
            --state-info: 6 182 212;
            --state-error: 239 68 68;
            --text-on-accent: 255 255 255;
        }

        [data-theme="sunset"] {
            --bg-app: 255 247 237;
            --bg-card: 255 237 213;
            --bg-elevated: 254 215 170;
            --text-primary: 124 45 18;
            --text-secondary: 154 52 18;
            --text-tertiary: 194 65 12;
            --accent-primary: 234 88 12;
            --accent-hover: 194 65 12;
            --border-primary: 254 215 170;
            --border-secondary: 253 186 116;
            --state-success: 34 197 94;
            --state-warning: 217 119 6;
            --state-info: 234 88 12;
            --state-error: 239 68 68;
            --text-on-accent: 255 255 255;
        }

        [data-theme="lavender"] {
            --bg-app: 250 245 255;
            --bg-card: 243 232 255;
            --bg-elevated: 233 213 255;
            --text-primary: 59 7 100;
            --text-secondary: 88 28 135;
            --text-tertiary: 107 33 168;
            --accent-primary: 147 51 234;
            --accent-hover: 126 34 206;
            --border-primary: 233 213 255;
            --border-secondary: 216 180 254;
            --state-success: 52 211 153;
            --state-warning: 234 179 8;
            --state-info: 99 102 241;
            --state-error: 220 38 38;
            --text-on-accent: 255 255 255;
        }

        [data-theme="forest"] {
            --bg-app: 240 253 244;
            --bg-card: 220 252 231;
            --bg-elevated: 187 247 208;
            --text-primary: 20 83 45;
            --text-secondary: 21 128 61;
            --text-tertiary: 22 163 74;
            --accent-primary: 34 197 94;
            --accent-hover: 22 163 74;
            --border-primary: 187 247 208;
            --border-secondary: 134 239 172;
            --state-success: 34 197 94;
            --state-warning: 217 119 6;
            --state-info: 34 197 94;
            --state-error: 185 28 28;
            --text-on-accent: 255 255 255;
        }

        html, body {
            height: 100%;
            margin: 0;
        }
        .tab-content {
            height: calc(100vh - 70px);
        }
        details summary {
            cursor: pointer;
            user-select: none;
        }
        details summary::-webkit-details-marker {
            display: none;
        }
        .tool-checkbox-wrapper {
            position: relative;
        }
        .tool-checkbox-wrapper input[type="checkbox"] {
            position: absolute;
            opacity: 0;
            pointer-events: none;
        }
        .tool-checkbox-wrapper label {
            display: inline-block;
            padding: 6px 14px;
            border: 1.5px solid rgb(var(--border-secondary));
            border-radius: 9999px;
            background: rgb(var(--bg-card));
            color: rgb(var(--text-secondary));
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        .tool-checkbox-wrapper label:hover {
            border-color: rgb(var(--border-primary));
            background: rgb(var(--bg-elevated));
        }
        .tool-checkbox-wrapper input[type="checkbox"]:checked + label {
            background: rgb(var(--accent-primary));
            border-color: rgb(var(--accent-primary));
            color: rgb(var(--text-on-accent));
            font-weight: 500;
        }
        .tool-checkbox-wrapper input[type="checkbox"]:disabled + label {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .tool-checkbox-wrapper input[type="checkbox"]:disabled + label:hover {
            border-color: rgb(var(--border-secondary));
            background: rgb(var(--bg-card));
        }
        .tab-button.text-amber-600 {
            font-weight: 600;
        }
        .message-bubble {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .message-body {
            position: relative;
        }
        .message-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.75rem;
            font-size: 12px;
            color: rgb(var(--text-secondary));
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgb(var(--border-primary) / 0.4);
        }
        .message-footer-right {
            justify-content: flex-end;
        }
        .message-footer-has-tools {
            align-items: flex-start;
        }
        .message-footer-has-tools .message-footer-content {
            display: flex;
            flex: 1;
            min-width: 0;
            flex-direction: column;
            gap: 0.5rem;
        }
        .message-footer-has-tools .message-footer-actions {
            padding-top: 0.1rem;
        }
        .message-footer-content {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            line-height: 1.4;
        }
        .message-footer-content span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }
        .message-footer-actions {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .copy-button {
            border: 1px solid rgb(var(--border-primary));
            border-radius: 9999px;
            background: rgb(var(--bg-elevated));
            color: rgb(var(--text-primary));
            padding: 2px 8px;
            font-size: 12px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            transition: background-color 0.15s ease, opacity 0.15s ease;
        }
        .copy-button:hover {
            background: rgb(var(--accent-primary) / 0.12);
            border-color: rgb(var(--accent-primary));
        }
        .copy-button:disabled {
            cursor: default;
            opacity: 0.6;
        }
        .copy-button svg {
            width: 14px;
            height: 14px;
            display: block;
        }
        .message-bubble pre {
            position: relative;
            padding: 1rem 1rem 2.5rem;
            max-width: 100%;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .message-bubble pre code {
            display: block;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .message-bubble pre .copy-button {
            position: absolute;
            right: 0.75rem;
            bottom: 0.75rem;
            background: rgb(var(--bg-elevated));
            color: rgb(var(--text-primary));
            border: 1px solid rgb(var(--border-primary));
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 12px;
        }
        .message-bubble pre .copy-button:hover {
            background: rgb(var(--accent-primary) / 0.2);
            border-color: rgb(var(--accent-primary));
        }
        .message-bubble.message-assistant .message-footer {
            border-top: 1px solid rgb(var(--border-primary));
            color: rgb(var(--text-secondary));
        }
        .message-bubble.message-assistant .copy-button {
            background: rgb(var(--bg-elevated));
            color: rgb(var(--text-primary));
            border: 1px solid rgb(var(--border-primary));
        }
        .message-bubble.message-assistant .copy-button:hover {
            background: rgb(var(--accent-primary) / 0.2);
            border-color: rgb(var(--accent-primary));
        }
        .message-bubble.message-assistant .copy-button:disabled {
            opacity: 0.6;
        }
        .message-bubble.message-user {
            background: rgb(var(--bg-elevated));
            color: rgb(var(--text-primary));
        }
        .message-bubble.message-assistant {
            background: rgb(var(--accent-primary) / 0.08);
            border: 1px solid rgb(var(--border-primary));
            color: rgb(var(--text-primary));
        }
        .message-bubble.message-assistant .message-body,
        .message-bubble.message-assistant .message-body p,
        .message-bubble.message-assistant .message-body li,
        .message-bubble.message-assistant .message-body code,
        .message-bubble.message-assistant .message-body strong,
        .message-bubble.message-assistant .message-body em {
            color: rgb(var(--text-primary));
        }
        .message-bubble.message-assistant .message-body * {
            color: rgb(var(--text-primary));
        }
        .message-bubble.message-assistant .message-body a {
            color: rgb(var(--accent-primary));
        }
        .message-bubble.message-assistant .message-body a:hover {
            color: rgb(var(--accent-hover));
        }
        .message-bubble.message-assistant .message-body hr {
            border-color: rgb(var(--border-primary));
        }
        .message-bubble.message-assistant pre {
            background: rgb(var(--bg-elevated));
            border: 1px solid rgb(var(--border-primary));
            color: rgb(var(--text-primary));
        }
        .message-bubble.message-assistant pre code {
            color: inherit;
        }
        .stream-progress {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            color: rgb(var(--text-secondary));
        }
        .stream-status-indicator {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 9999px;
            background: rgb(var(--accent-primary) / 0.15);
            color: rgb(var(--accent-primary));
            font-weight: 600;
        }
        .stream-status-indicator.typing {
            background: transparent;
            width: auto;
            height: auto;
        }
        .stream-status-indicator.success {
            background: rgb(var(--state-success) / 0.15);
            color: rgb(var(--state-success));
        }
        .stream-status-indicator.error {
            background: rgb(var(--state-warning) / 0.2);
            color: rgb(var(--state-warning));
        }
        .stream-status-indicator.tool {
            background: rgb(var(--state-info) / 0.18);
            color: rgb(var(--state-info));
        }
        .stream-status-text {
            font-weight: 500;
        }
        .typing-indicator {
            display: inline-flex;
            gap: 0.35rem;
        }
        .typing-dot {
            width: 0.4rem;
            height: 0.4rem;
            background: rgb(var(--accent-primary));
            border-radius: 9999px;
            opacity: 0.2;
            animation: typing 1.2s infinite;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 80%, 100% {
                opacity: 0.2;
                transform: translateY(0);
            }
            40% {
                opacity: 1;
                transform: translateY(-3px);
            }
        }
        .tool-status-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }
        .tool-calls-section {
            margin-top: 0.75rem;
            border: 1px solid rgb(var(--border-primary) / 0.6);
            border-radius: 0.6rem;
            background: rgb(var(--bg-elevated) / 0.5);
            overflow: hidden;
        }
        .message-footer .tool-calls-section {
            margin-top: 0;
            width: 100%;
        }
        .tool-calls-section .tool-status-list {
            margin: 0;
            padding: 0.65rem 0.75rem 0.75rem;
            border-top: 1px solid rgb(var(--border-primary) / 0.45);
        }
        .tool-status {
            margin: 0;
            padding: 0;
            border: 1px solid rgb(var(--accent-primary) / 0.25);
            border-radius: 0.6rem;
            background: rgb(var(--bg-elevated) / 0.7);
            font-size: 0.85rem;
            overflow: hidden;
        }
        .tool-status.tool-status-complete {
            border-color: rgb(var(--accent-primary) / 0.45);
        }
        .tool-status-summary {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.55rem 0.75rem;
            cursor: pointer;
            list-style: none;
            font-weight: 600;
            color: rgb(var(--text-primary));
        }
        .tool-status-summary::-webkit-details-marker,
        .tool-status-summary::marker {
            display: none;
            content: '';
        }
        .tool-status-chevron {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 1.25rem;
            height: 1.25rem;
            font-size: 0.9rem;
            color: rgb(var(--accent-primary));
            transition: color 0.15s ease;
        }
        .tool-status[open] .tool-status-chevron {
            color: rgb(var(--accent-hover));
        }
        .tool-status.tool-status-complete .tool-status-chevron {
            color: rgb(var(--accent-hover));
        }
        .tool-status-body {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            padding: 0.65rem 0.75rem 0.75rem;
            background: rgb(var(--bg-card));
            border-top: 1px solid rgb(var(--border-primary) / 0.5);
        }
        .tool-status-detail-container {
            display: flex;
            flex-direction: column;
            gap: 0.65rem;
        }
        .tool-status-section {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }
        .tool-status-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: rgb(var(--accent-primary));
        }
        .tool-status-block {
            margin: 0;
            padding: 0.55rem 0.65rem;
            background: rgb(var(--accent-primary) / 0.08);
            border-radius: 0.5rem;
            font-size: 0.8rem;
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
            white-space: pre-wrap;
            word-break: break-word;
            max-height: 16rem;
            max-width: 100%;
            overflow: auto;
            color: rgb(var(--text-primary));
        }
        .tool-status-placeholder {
            font-size: 0.8rem;
            color: rgb(var(--text-secondary));
            font-style: italic;
        }
        summary.collapsible-summary {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            font-weight: 600;
            color: rgb(var(--text-primary));
            cursor: pointer;
            user-select: none;
            transition: background-color 0.15s ease;
        }
        summary.collapsible-summary:hover {
            background-color: rgb(var(--bg-elevated));
        }
        summary.collapsible-summary .summary-text {
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }
        summary.collapsible-summary .summary-title {
            font-weight: 600;
            color: rgb(var(--text-primary));
        }
        summary.collapsible-summary .summary-subtext {
            font-size: 0.85rem;
            color: rgb(var(--text-secondary));
            font-weight: 400;
        }
        summary.collapsible-summary .chevron {
            width: 1rem;
            height: 1rem;
            color: rgb(var(--text-secondary));
            transition: transform 0.2s ease;
        }
        details[open] summary.collapsible-summary .chevron {
            transform: rotate(180deg);
            color: rgb(var(--text-primary));
        }

        /* Theme-aware state helpers */
        .state-success {
            color: rgb(var(--state-success));
        }
        .state-error {
            color: rgb(var(--state-error));
        }
        .state-warning {
            color: rgb(var(--state-warning));
        }
        .state-info {
            color: rgb(var(--state-info));
        }
        .state-surface-success {
            background: rgb(var(--state-success) / 0.12);
            border-color: rgb(var(--state-success) / 0.35);
            color: rgb(var(--state-success));
        }
        .state-surface-error {
            background: rgb(var(--state-error) / 0.12);
            border-color: rgb(var(--state-error) / 0.35);
            color: rgb(var(--state-error));
        }
        .state-surface-warning {
            background: rgb(var(--state-warning) / 0.12);
            border-color: rgb(var(--state-warning) / 0.35);
            color: rgb(var(--state-warning));
        }
        .state-surface-info {
            background: rgb(var(--state-info) / 0.12);
            border-color: rgb(var(--state-info) / 0.35);
            color: rgb(var(--state-info));
        }
        .log-line {
            display: block;
            padding: 2px 6px;
            border-left: 3px solid transparent;
        }
        .log-level-error {
            background: rgb(var(--state-error) / 0.1);
            color: rgb(var(--state-error));
            border-color: rgb(var(--state-error) / 0.8);
        }
        .log-level-warn {
            background: rgb(var(--state-warning) / 0.1);
            color: rgb(var(--state-warning));
            border-color: rgb(var(--state-warning) / 0.8);
        }
        .log-level-info {
            color: rgb(var(--state-info));
            border-color: rgb(var(--state-info) / 0.6);
        }
        .log-level-debug {
            color: rgb(var(--text-tertiary));
            border-color: rgb(var(--border-secondary));
        }
        .editing-highlight {
            background: rgb(var(--accent-primary) / 0.08);
            box-shadow: 0 0 0 2px rgb(var(--accent-primary) / 0.2);
        }
        .pill-success {
            background: rgb(var(--state-success) / 0.15);
            color: rgb(var(--state-success));
            border: 1px solid rgb(var(--state-success) / 0.4);
        }
        .pill-error {
            background: rgb(var(--state-error) / 0.15);
            color: rgb(var(--state-error));
            border: 1px solid rgb(var(--state-error) / 0.4);
        }
        .pill-info {
            background: rgb(var(--state-info) / 0.15);
            color: rgb(var(--state-info));
            border: 1px solid rgb(var(--state-info) / 0.35);
        }
        .btn-secondary {
            background: rgb(var(--accent-primary) / 0.08);
            border: 1px solid rgb(var(--accent-primary) / 0.35);
            color: rgb(var(--accent-primary));
            transition: background-color 0.15s ease, border-color 0.15s ease, color 0.15s ease;
        }
        .btn-secondary:hover {
            background: rgb(var(--accent-primary) / 0.14);
            border-color: rgb(var(--accent-primary) / 0.55);
            color: rgb(var(--accent-hover));
        }
    </style>
</head>
<body class="bg-app-bg transition-colors duration-200">
    <div class="container mx-auto max-w-6xl px-4 pt-2 pb-0">
        <!-- Tabs -->
        <div class="mb-4">
            <div class="border-b border-border-primary">
                <div class="flex items-center justify-between">
                    <nav class="-mb-px flex flex-wrap space-x-4 min-w-0">
                        <button id="chat-tab" class="tab-button border-b-2 border-accent py-2 px-1 text-sm font-medium text-accent">
                            Chat
                        </button>
                        <button id="dashboard-tab" class="tab-button border-b-2 border-transparent py-2 px-1 text-sm font-medium text-txt-secondary hover:border-border-secondary hover:text-txt-primary">
                            Workflows
                        </button>
                        <button id="configuration-tab" class="tab-button border-b-2 border-transparent py-2 px-1 text-sm font-medium text-txt-secondary hover:border-border-secondary hover:text-txt-primary">
                            Configuration
                        </button>
                    </nav>
                    <div class="flex items-center gap-3 flex-shrink-0 relative z-10">
                        <button id="theme-toggle" type="button" class="text-2xl hover:opacity-75 transition-opacity focus:outline-none cursor-pointer" style="touch-action: manipulation;" title="Change theme">
                            üé®
                        </button>
                        <button id="new-session-btn" type="button" class="text-2xl text-txt-secondary hover:text-txt-primary focus:outline-none mr-2 cursor-pointer" style="touch-action: manipulation;" title="New Session">
                            ‚ûï
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Chat Tab Content -->
        <div id="chat-content" class="tab-content flex flex-col">
            <!-- Chat Settings Section -->
            <details class="mb-4 bg-app-card border border-border-primary rounded-lg shadow-sm flex-shrink-0">
                <summary class="collapsible-summary">
                    <div class="summary-text">
                        <span class="summary-title">Chat Settings</span>
                    </div>
                    <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                        <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </summary>
                <div class="p-4 pt-2 space-y-3">
                    <!-- Vault & Model Selection -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <select id="vault-selector" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary">
                            <option value="">Select vault...</option>
                        </select>
                        <select id="model-selector" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary">
                            <option value="">Select model...</option>
                        </select>
                    </div>
                    <!-- Context Template -->
                    <div class="grid grid-cols-1 gap-3">
                        <select id="template-selector" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary">
                            <option value="">Select template...</option>
                        </select>
                    </div>
                    <!-- Tools -->
                    <div id="tools-checkboxes" class="flex flex-wrap gap-2">
                        <!-- Tool checkboxes will be added here -->
                    </div>
                </div>
            </details>

            <!-- Chat Container -->
            <div class="bg-app-card border border-border-primary rounded-lg shadow-sm flex flex-col flex-1 overflow-hidden">
                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4">
                    <div class="text-center text-txt-secondary text-sm">
                        Start a conversation...
                    </div>
                </div>
                <div class="border-t border-border-primary p-4">
                    <div class="flex gap-2">
                        <textarea
                            id="chat-input"
                            rows="3"
                            placeholder="Type your message (Ctrl+Enter or Cmd+Enter to send)..."
                            class="flex-1 px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent resize-y bg-app-bg text-txt-primary"
                        ></textarea>
                        <button
                            id="send-btn"
                            class="px-6 py-2 bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent disabled:opacity-50 disabled:cursor-not-allowed"
                        >
                            Send
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Tab Content -->
        <div id="dashboard-content" class="tab-content hidden">
            <!-- Rescan Vaults - Compact Control -->
            <div class="mb-4 bg-app-card border border-border-primary rounded-lg shadow-sm p-3">
                <div class="flex items-center gap-3">
                    <button id="rescan-btn" class="px-4 py-2 bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent whitespace-nowrap">
                        üîÑ Rescan Vaults
                    </button>
                    <span class="text-sm text-txt-secondary">Discover new vaults and reload workflow configurations</span>
                </div>
                <div id="rescan-result" class="mt-2 text-sm"></div>
            </div>

            <!-- System Status -->
            <div class="mb-4 bg-app-card border border-border-primary rounded-lg shadow-sm p-4">
                <div id="system-status" class="space-y-2 text-sm text-txt-primary">
                    <p>Loading...</p>
                </div>
            </div>

            <!-- Execute Workflow -->
            <div class="mb-4 bg-app-card border border-border-primary rounded-lg shadow-sm p-4">
                <h2 class="text-xl font-bold text-txt-primary mb-3">Execute Workflow</h2>
                <div class="space-y-3">
                    <div>
                        <label class="block text-sm font-medium text-txt-primary mb-1">Workflow ID</label>
                        <select id="workflow-selector" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-bg text-txt-primary">
                            <option value="">Select workflow...</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-txt-primary mb-1">Step (optional - blank for all steps)</label>
                        <input
                            id="step-name-input"
                            type="text"
                            placeholder="Leave blank to run all steps"
                            class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-bg text-txt-primary"
                        />
                    </div>
                    <button id="execute-workflow-btn" class="px-4 py-2 bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent">
                        Execute Workflow
                    </button>
                    <div id="execute-workflow-result" class="text-sm"></div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab Content -->
        <div id="configuration-content" class="tab-content hidden">
            <!-- Status/Warning Banner -->
            <div id="config-status-banner" class="mb-4 p-4 bg-app-elevated border border-border-primary rounded-lg shadow-sm hidden transition-colors">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">‚ö†Ô∏è</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-txt-primary mb-1">System Notices</h3>
                        <div id="config-status-messages" class="text-sm text-txt-secondary space-y-1">
                            <!-- Messages will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-4">
                <details id="config-models-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">Models</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-4">
                        <p class="text-sm text-txt-secondary">
                            Model mappings connect workflow-friendly names to provider models. Availability reflects current API key configuration.
                        </p>
                        <div class="flex flex-col gap-3">
                            <div class="flex items-center justify-between gap-3">
                                <div id="model-feedback" class="flex-1 text-sm text-txt-secondary"></div>
                                <button id="model-add-row" type="button" class="shrink-0 px-3 py-2 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent">
                                    Add Model
                                </button>
                            </div>
                            <div id="model-list" class="flex flex-col gap-3">
                                <div class="rounded-lg border border-border-primary bg-app-card px-4 py-3 text-sm text-txt-secondary text-center shadow-sm">
                                    No models configured.
                                </div>
                            </div>
                        </div>
                    </div>
                </details>

                <details id="config-providers-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">Model Providers</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-4">
                        <p class="text-sm text-txt-secondary">
                            Providers define API keys or base URLs for custom endpoints. Built-in providers are read-only. Enter secret names in the fields below and manage their values from the Secrets section.
                        </p>
                        <div id="provider-feedback" class="text-sm text-txt-secondary"></div>
                        <div id="provider-list" class="flex flex-col gap-3">
                            <div class="rounded-lg border border-border-primary bg-app-card px-4 py-3 text-sm text-txt-secondary text-center shadow-sm">
                                No custom providers configured.
                            </div>
                        </div>
                        <form id="provider-form" class="grid grid-cols-1 md:grid-cols-3 gap-4 bg-app-elevated border border-border-primary rounded-md p-4">
                            <div>
                                <label for="provider-name" class="block text-sm font-medium text-txt-primary mb-1">Provider Name</label>
                                <input id="provider-name" name="provider-name" type="text" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary" placeholder="e.g. local-ollama" required>
                            </div>
                            <div>
                                <label for="provider-api-key-value" class="block text-sm font-medium text-txt-primary mb-1">API Key Secret (optional)</label>
                                <input id="provider-api-key" name="provider-api-key" type="text" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary" placeholder="SECRET_NAME (optional)">
                                <p class="text-xs text-txt-secondary mt-1">Enter the secret name; use the Secrets form below to set its value.</p>
                            </div>
                            <div>
                                <label for="provider-base-url" class="block text-sm font-medium text-txt-primary mb-1">Base URL Secret (optional)</label>
                                <input id="provider-base-url" name="provider-base-url" type="text" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary" placeholder="SECRET_NAME (optional)">
                                <p class="text-xs text-txt-secondary mt-1">Base URLs are stored as secrets; enter the secret name and manage the URL value via the Secrets form.</p>
                            </div>
                            <div class="md:col-span-3 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                <span id="provider-form-status" class="text-sm text-txt-secondary"></span>
                                <div class="flex items-center gap-2">
                                    <button type="button" id="provider-reset" class="px-3 py-2 text-sm btn-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent">
                                        Cancel
                                    </button>
                                    <button type="submit" id="provider-submit" class="px-3 py-2 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent">
                                        Save Provider
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </details>

                <details id="config-settings-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">Application Settings</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-4">
                        <p class="text-sm text-txt-secondary">
                            Update non-secret runtime settings. Changes apply immediately unless otherwise specified. Values are stored as plain text; use JSON for lists or objects.
                        </p>
                        <div id="settings-feedback" class="text-sm text-txt-secondary"></div>
                        <div id="settings-list" class="flex flex-col gap-3">
                            <div class="rounded-lg border border-border-primary bg-app-card px-4 py-3 text-sm text-txt-secondary text-center shadow-sm">
                                Loading settings‚Ä¶
                            </div>
                        </div>
                    </div>
                </details>

                <details id="config-secrets-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">Secrets</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-3">
                        <p class="text-sm text-txt-secondary">
                            API keys and other credentials can be updated here. Use the form below to add new secrets or overwrite existing ones. Changes take effect immediately‚Äîno container restart required.
                        </p>
                        <div class="bg-app-elevated border border-border-primary rounded-md p-4">
                            <form id="secret-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="secret-name" class="block text-sm font-medium text-txt-primary mb-1">Secret Name</label>
                                    <input id="secret-name" name="secret-name" type="text" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary" placeholder="e.g. LOCAL_MODEL_TOKEN" required>
                                    <p class="text-xs text-txt-secondary mt-1">Use uppercase letters, numbers, or underscores. The name becomes available to providers immediately.</p>
                                </div>
                                <div>
                                    <label for="secret-value" class="block text-sm font-medium text-txt-primary mb-1">Secret Value</label>
                                    <input id="secret-value" name="secret-value" type="password" class="w-full px-3 py-2 border border-border-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent bg-app-card text-txt-primary" placeholder="Enter the credential" required>
                                    <p class="text-xs text-txt-secondary mt-1">Values are stored as plain text inside <code>system/secrets.yaml</code>.</p>
                                </div>
                                <div class="md:col-span-2 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                                    <span id="secret-form-status" class="text-sm text-txt-secondary"></span>
                                    <div class="flex items-center gap-2">
                                        <button type="button" id="secret-reset" class="px-3 py-2 text-sm btn-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent">
                                            Cancel
                                        </button>
                                        <button type="submit" id="secret-submit" class="px-3 py-2 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent">
                                            Save Secret
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div id="secrets-list" class="flex flex-col gap-3">
                            <div class="rounded-lg border border-border-primary bg-app-card px-4 py-3 text-sm text-txt-secondary text-center shadow-sm">
                                Loading secrets‚Ä¶
                            </div>
                        </div>
                    </div>
                </details>

                <details id="config-activity-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">System Activity Log</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-3">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                            <p class="text-sm text-txt-secondary">
                                Runtime events are written to <code>system/activity.log</code>. Refresh to load the latest entries.
                            </p>
                            <button id="refresh-activity-log" type="button" class="self-start md:self-auto px-3 py-1.5 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent disabled:opacity-70 disabled:cursor-not-allowed">
                                Refresh
                            </button>
                        </div>
                        <div class="border border-border-primary rounded-md">
                            <pre id="activity-log-viewer" class="overflow-y-auto whitespace-pre-wrap p-3 text-sm font-mono text-txt-primary max-h-96">Loading system log...</pre>
                        </div>
                    </div>
                </details>

                <details id="config-import-section" class="bg-app-card border border-border-primary rounded-lg shadow-sm">
                    <summary class="collapsible-summary">
                        <div class="summary-text">
                            <span class="summary-title">Import</span>
                        </div>
                        <svg class="chevron" viewBox="0 0 20 20" fill="none" aria-hidden="true">
                            <path d="M6 8l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </summary>
                    <div class="p-4 pt-0 space-y-4">
                        <p class="text-sm text-txt-secondary">
                            Drop files into AssistantMD/Import/ inside your vault, then click Import Files to import them immediately. Files are removed after successful import.
                        </p>
                        <div class="space-y-3 border border-border-primary rounded-md p-4">
                            <div class="flex flex-col md:flex-row md:items-center gap-3">
                                <div class="md:flex-1 md:max-w-xl">
                                    <select id="import-vault-select" class="w-full px-3 py-2 border border-border-secondary rounded-md bg-app-card text-txt-primary focus:outline-none focus:ring-2 focus:ring-accent">
                                        <option value="">Select vault‚Ä¶</option>
                                    </select>
                                </div>
                                <div class="flex items-end">
                                    <button id="import-refresh-vaults" type="button" class="px-3 py-2 text-sm btn-secondary rounded-md focus:outline-none focus:ring-2 focus:ring-accent h-10">
                                        Refresh Vaults
                                    </button>
                                </div>
                            </div>

                            <div class="flex flex-col md:flex-row md:items-center gap-3 md:gap-4">
                                <div class="flex items-center gap-4">
                                    <label class="flex items-center gap-2 text-sm text-txt-primary">
                                        <input id="import-use-ocr" type="checkbox" class="h-4 w-4 text-accent border-border-secondary rounded focus:ring-accent">
                                        <span>Use OCR (PDF)</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-sm text-txt-primary">
                                        <input id="import-capture-ocr-images" type="checkbox" class="h-4 w-4 text-accent border-border-secondary rounded focus:ring-accent">
                                        <span>Capture OCR images</span>
                                    </label>
                                    <label class="flex items-center gap-2 text-sm text-txt-primary">
                                        <input id="import-queue" type="checkbox" class="h-4 w-4 text-accent border-border-secondary rounded focus:ring-accent">
                                        <span>Large job (queue)</span>
                                    </label>
                                </div>
                                <div class="flex items-end justify-end">
                                    <button id="import-scan" type="button" class="px-3 py-2 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent disabled:opacity-70 disabled:cursor-not-allowed h-10">
                                        Import Files
                                    </button>
                                </div>
                            </div>

                            <div class="flex flex-col md:flex-row gap-4 items-end">
                                <div class="md:flex-1">
                                    <input id="import-url-input" type="text" placeholder="https://example.com/article" class="w-full px-3 py-2 border border-border-secondary rounded-md bg-app-card text-txt-primary focus:outline-none focus:ring-2 focus:ring-accent">
                                </div>
                                <div class="flex items-end justify-end">
                                    <button id="import-url-submit" type="button" class="px-3 py-2 text-sm bg-accent text-white rounded-md hover:bg-accent-hover focus:outline-none focus:ring-2 focus:ring-accent disabled:opacity-70 disabled:cursor-not-allowed h-10">
                                        Import URL
                                    </button>
                                </div>
                            </div>

                            <div class="text-sm text-txt-secondary">
                                <span id="import-status"></span>
                            </div>
                        </div>

                        <div id="import-results" class="border border-border-primary rounded-md bg-app-elevated p-4 text-sm text-txt-secondary">
                            No imports yet.
                        </div>
                    </div>
                </details>
            </div>
        </div>
    </div>

    <script src="static/js/configuration.js"></script>
    <script src="static/app.js"></script>
</body>
</html>
